import { initI18n, applyI18n } from './i18n.js';
const root=document.documentElement,yearSpan=document.getElementById('year'),themeBtn=document.getElementById('themeBtn'),rtlBtn=document.getElementById('rtlBtn'),menuBtn=document.getElementById('menuBtn'),mobileNav=document.getElementById('mobileNav'),navbar=document.getElementById('navbar'),spotlight=document.getElementById('spotlight'),heroBgEl=document.getElementById('heroBg'),iconSun=document.getElementById('icon-sun'),iconMoon=document.getElementById('icon-moon'),metaTheme=document.querySelector('meta[name="theme-color"]');yearSpan&&(yearSpan.textContent=(new Date).getFullYear());function timeBasedTheme(){const e=new Date,t=60*e.getHours()+e.getMinutes();return t>=330&&t<1080?'light':'dark'}function setTheme(e){const t='dark'===e;root.classList.toggle('dark',t),iconSun&&iconMoon&&(iconSun.classList.toggle('hidden',t),iconMoon.classList.toggle('hidden',!t)),metaTheme&&metaTheme.setAttribute('content',t?'#0b1220':'#14b8a6'),refreshVanta()}function loadThemePref(){try{return JSON.parse(localStorage.getItem('themePref')||'{}')}catch(e){return{}}}function saveThemePref(e){try{localStorage.setItem('themePref',JSON.stringify(e))}catch(e){}}let themePref=loadThemePref();themePref.mode||(themePref={mode:'auto',theme:timeBasedTheme()},saveThemePref(themePref)),setTheme(themePref.theme),themeBtn?.addEventListener('click',e=>{if(e.shiftKey)return themePref.mode='auto',themePref.theme=timeBasedTheme(),setTheme(themePref.theme),void saveThemePref(themePref);themePref.mode='manual',themePref.theme='dark'===themePref.theme?'light':'dark',setTheme(themePref.theme),saveThemePref(themePref)}),setInterval(()=>{if('auto'===themePref.mode){const e=timeBasedTheme();e!==themePref.theme&&(themePref.theme=e,setTheme(e),saveThemePref(themePref))}},9e5),rtlBtn?.addEventListener('click',()=>{document.documentElement.dir='rtl'===document.documentElement.dir?'ltr':'rtl'}),menuBtn?.addEventListener('click',()=>mobileNav.classList.toggle('hidden'));const onScroll=()=>navbar.classList.toggle('nav-opaque',window.scrollY>8);onScroll(),window.addEventListener('scroll',onScroll,{passive:!0});const reduceMotion=window.matchMedia('(prefers-reduced-motion: reduce)').matches;!reduceMotion&&window.matchMedia('(pointer:fine)').matches&&spotlight&&window.addEventListener('pointermove',e=>{const t=document.body.getBoundingClientRect();spotlight.style.setProperty('--mx',100*((e.clientX-t.left)/t.width)+'%'),spotlight.style.setProperty('--my',100*((e.clientY-t.top)/t.height)+'%')});initI18n();let vantaEffect=null;function destroyVanta(){try{vantaEffect&&vantaEffect.destroy&&vantaEffect.destroy()}catch(e){}vantaEffect=null}function initVanta(){const e=window.matchMedia('(prefers-reduced-motion: reduce)').matches;if(e||!window.VANTA||!heroBgEl)return;const t=window.matchMedia('(pointer:coarse)').matches;try{vantaEffect=window.VANTA.NET({el:heroBgEl,mouseControls:!t,touchControls:t,gyroControls:!1,color:0x14b8a6,backgroundColor:root.classList.contains('dark')?0x0b1220:0xffffff,points:t?6:8,maxDistance:t?14:18,spacing:t?20:16,showDots:!1,scale:1,scaleMobile:1})}catch(e){console.warn('Vanta init error',e)}}function refreshVanta(){destroyVanta(),initVanta()}window.addEventListener('load',()=>{refreshVanta();try{if(!reduceMotion&&window.matchMedia('(pointer:fine)').matches&&window.VanillaTilt)window.VanillaTilt.init(document.querySelectorAll('[data-tilt]'),{speed:400,scale:1.02,max:8});else!reduceMotion&&window.matchMedia('(pointer:coarse)').matches&&document.querySelectorAll('.project-card').forEach(e=>{e.addEventListener('touchstart',()=>e.classList.add('active-press'),{passive:!0}),['touchend','touchcancel'].forEach(t=>e.addEventListener(t,()=>e.classList.remove('active-press')))})}catch(e){console.warn('Tilt init error',e)}});const dock=document.getElementById('dock'),dockNav=document.getElementById('dockNav'),dockBtn=document.getElementById('dockProjects');function revealProjects(){document.querySelectorAll('#projects .project-card').forEach((e,t)=>setTimeout(()=>e.classList.add('visible'),120*t))}dockBtn?.addEventListener('click',()=>{const e=document.getElementById('projects');dock.classList.add('pointer-events-none'),dockNav.classList.add('puff-out'),e&&e.scrollIntoView({behavior:'smooth',block:'start'}),revealProjects()}),dockNav?.addEventListener('animationend',()=>{dock.style.display='none'});const projSec=document.getElementById('projects');if('IntersectionObserver'in window&&projSec){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(revealProjects(),t.disconnect())})},{threshold:.2});var t=e;e.observe(projSec)}else setTimeout(revealProjects,600);(function(){[['refreshVanta exists','function'==typeof refreshVanta],['applyI18n available','function'==typeof applyI18n],['Dock button present',!!dockBtn],['Theme meta updates',!!metaTheme]].forEach(([e,t])=>console[t?'info':'warn']('TEST:',e,t?'OK':'FAIL'))})();
